"use strict";(()=>{var e={};e.id=387,e.ids=[387],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4988:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>m,patchFetch:()=>N,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>x,staticGenerationAsyncStorage:()=>y});var n={};s.r(n),s.d(n,{DELETE:()=>c,GET:()=>u,PUT:()=>d});var r=s(35847),i=s(67605),a=s(52520),o=s(24176),l=s(86632);async function u(e,{params:t}){try{let e=parseInt(t.id,10);if(isNaN(e))return o.NextResponse.json({error:"Invalid context ID"},{status:400});let s=(0,l.getBusinessContextRepository)(),n=await s.findById(e);if(!n)return o.NextResponse.json({error:"Business context not found"},{status:404});return o.NextResponse.json(n,{status:200})}catch(e){return console.error(`[API] Error fetching business context ${t.id}:`,e),o.NextResponse.json({error:"Failed to fetch business context"},{status:500})}}async function d(e,{params:t}){try{let s=parseInt(t.id,10);if(isNaN(s))return o.NextResponse.json({error:"Invalid context ID"},{status:400});let n=await e.json(),r=(0,l.getBusinessContextRepository)();if(!await r.findById(s))return o.NextResponse.json({error:"Business context not found"},{status:404});let i={entityName:n.entityName,entityType:n.entityType,industry:n.industry||null,description:n.description||null,aliases:n.aliases||[],relatedEntities:n.relatedEntities||[],technologyPortfolio:n.technologyPortfolio||null,serviceDetails:n.serviceDetails||null,keyContacts:n.keyContacts||[],slackChannels:n.slackChannels||[],cmdbIdentifiers:n.cmdbIdentifiers||[],contextStewards:n.contextStewards||[],isActive:void 0===n.isActive||n.isActive},a=await r.update(s,i);if(!a)return o.NextResponse.json({error:"Failed to update business context"},{status:500});return o.NextResponse.json(a,{status:200})}catch(e){return console.error(`[API] Error updating business context ${t.id}:`,e),o.NextResponse.json({error:"Failed to update business context"},{status:500})}}async function c(e,{params:t}){try{let e=parseInt(t.id,10);if(isNaN(e))return o.NextResponse.json({error:"Invalid context ID"},{status:400});let s=(0,l.getBusinessContextRepository)();if(!await s.findById(e))return o.NextResponse.json({error:"Business context not found"},{status:404});if(!await s.delete(e))return o.NextResponse.json({error:"Failed to delete business context"},{status:500});return o.NextResponse.json({success:!0,message:"Business context deleted"},{status:200})}catch(e){return console.error(`[API] Error deleting business context ${t.id}:`,e),o.NextResponse.json({error:"Failed to delete business context"},{status:500})}}let p=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/business-contexts/[id]/route",pathname:"/api/business-contexts/[id]",filename:"route",bundlePath:"app/api/business-contexts/[id]/route"},resolvedPagePath:"/Users/hamadriaz/Documents/codebase/ai-sdk-slackbot/app/api/business-contexts/[id]/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:x}=p,m="/api/business-contexts/[id]/route";function N(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:y})}},51921:(e,t,s)=>{s.d(t,{xQ:()=>l,zA:()=>o});var n=s(4530),r=s(67461),i=s(19954);let a=null;function o(){if(!a){let e=process.env.DATABASE_URL;if(!e)return console.warn("[Database] DATABASE_URL not configured. Running in memory-only mode."),null;try{let t=(0,r.qn)(e);a=(0,n.tS)(t,{schema:i}),console.log("[Database] Connected to Neon Postgres")}catch(e){return console.error("[Database] Failed to initialize connection:",e),null}}return a}function l(){return!!process.env.DATABASE_URL}},86632:(e,t,s)=>{s.r(t),s.d(t,{BusinessContextRepository:()=>a,getBusinessContextRepository:()=>l});var n=s(30513),r=s(19954),i=s(51921);class a{async findByName(e){let t=(0,i.zA)();if(!t)return null;try{return(await t.select().from(r.businessContexts).where((0,n.xD)((0,n.o$)(r.businessContexts.entityName,e),(0,n.eq)(r.businessContexts.isActive,!0))).limit(1))[0]||null}catch(t){return console.error(`[Business Context Repo] Error finding by name "${e}":`,t),null}}async findByNameOrAlias(e){let t=(0,i.zA)();if(!t)return null;try{let s=await this.findByName(e);if(s)return s;let i=await t.select().from(r.businessContexts).where((0,n.eq)(r.businessContexts.isActive,!0)),a=e.toLowerCase();for(let e of i)if(e.aliases&&Array.isArray(e.aliases)&&e.aliases.some(e=>e.toLowerCase()===a))return e;return null}catch(t){return console.error(`[Business Context Repo] Error finding by name or alias "${e}":`,t),null}}async getAllActive(){let e=(0,i.zA)();if(!e)return[];try{return await e.select().from(r.businessContexts).where((0,n.eq)(r.businessContexts.isActive,!0)).orderBy(r.businessContexts.entityName)}catch(e){return console.error("[Business Context Repo] Error getting all active:",e),[]}}async getAll(){let e=(0,i.zA)();if(!e)return[];try{return await e.select().from(r.businessContexts).orderBy(r.businessContexts.entityName)}catch(e){return console.error("[Business Context Repo] Error getting all:",e),[]}}async findById(e){let t=(0,i.zA)();if(!t)return null;try{return(await t.select().from(r.businessContexts).where((0,n.eq)(r.businessContexts.id,e)).limit(1))[0]||null}catch(t){return console.error(`[Business Context Repo] Error finding by ID ${e}:`,t),null}}async getByType(e){let t=(0,i.zA)();if(!t)return[];try{return await t.select().from(r.businessContexts).where((0,n.xD)((0,n.eq)(r.businessContexts.entityType,e),(0,n.eq)(r.businessContexts.isActive,!0))).orderBy(r.businessContexts.entityName)}catch(t){return console.error(`[Business Context Repo] Error getting by type "${e}":`,t),[]}}async create(e){let t=(0,i.zA)();if(!t)return null;try{return(await t.insert(r.businessContexts).values(e).returning())[0]||null}catch(e){return console.error("[Business Context Repo] Error creating context:",e),null}}async update(e,t){let s=(0,i.zA)();if(!s)return null;try{return(await s.update(r.businessContexts).set({...t,updatedAt:new Date}).where((0,n.eq)(r.businessContexts.id,e)).returning())[0]||null}catch(t){return console.error(`[Business Context Repo] Error updating context ${e}:`,t),null}}async appendCmdbIdentifier(e,t,s={}){let a=(0,i.zA)();if(!a)return null;let o=await this.findByName(e);if(!o){if(!s.createIfMissing)return console.warn(`[Business Context Repo] appendCmdbIdentifier skipped â€“ ${e} does not exist`),null;if(!s.entityType)throw Error(`Cannot create ${e} without entityType when appending CMDB identifier`);let n={entityName:e,entityType:s.entityType,industry:s.defaults?.industry,description:s.defaults?.description,aliases:s.defaults?.aliases??[],relatedEntities:s.defaults?.relatedEntities??[],technologyPortfolio:s.defaults?.technologyPortfolio,serviceDetails:s.defaults?.serviceDetails,keyContacts:s.defaults?.keyContacts??[],slackChannels:s.defaults?.slackChannels??[],cmdbIdentifiers:[t],contextStewards:s.defaults?.contextStewards??[],isActive:s.defaults?.isActive??!0};return await this.create(n)}let l=Array.isArray(o.cmdbIdentifiers)?o.cmdbIdentifiers:[];if(l.some(e=>{if(t.sysId&&e.sysId&&e.sysId===t.sysId||t.ciName&&e.ciName&&e.ciName.toLowerCase()===t.ciName.toLowerCase())return!0;if(t.ipAddresses?.length){let s=t.ipAddresses.map(e=>e.trim()),n=e.ipAddresses?.map(e=>e.trim())??[];if(s.some(e=>n.includes(e)))return!0}return!1}))return console.log(`[Business Context Repo] CMDB identifier already present for ${e}, skipping append.`),o;let u=[...l,t];return(await a.update(r.businessContexts).set({cmdbIdentifiers:u,updatedAt:new Date}).where((0,n.eq)(r.businessContexts.id,o.id)).returning())[0]||null}async deactivate(e){let t=(0,i.zA)();if(!t)return!1;try{return await t.update(r.businessContexts).set({isActive:!1,updatedAt:new Date}).where((0,n.eq)(r.businessContexts.id,e)),!0}catch(t){return console.error(`[Business Context Repo] Error deactivating context ${e}:`,t),!1}}async delete(e){let t=(0,i.zA)();if(!t)return!1;try{return await t.delete(r.businessContexts).where((0,n.eq)(r.businessContexts.id,e)),!0}catch(t){return console.error(`[Business Context Repo] Error deleting context ${e}:`,t),!1}}}let o=null;function l(){return o||(o=new a),o}},19954:(e,t,s)=>{s.r(t),s.d(t,{businessContexts:()=>x,caseContexts:()=>p,caseMessages:()=>f,kbGenerationStates:()=>y});var n=s(48003),r=s(50017),i=s(44602),a=s(19766),o=s(26428),l=s(94212),u=s(47256),d=s(84825),c=s(64605);let p=(0,n.af)("case_contexts",{caseNumber:(0,r.fL)("case_number").notNull(),threadTs:(0,r.fL)("thread_ts").notNull(),channelId:(0,r.fL)("channel_id").notNull(),channelName:(0,r.fL)("channel_name"),channelTopic:(0,r.fL)("channel_topic"),channelPurpose:(0,r.fL)("channel_purpose"),isResolved:(0,i.O7)("is_resolved").default(!1).notNull(),resolvedAt:(0,a.AB)("resolved_at"),detectedAt:(0,a.AB)("detected_at").notNull().defaultNow(),lastUpdated:(0,a.AB)("last_updated").notNull().defaultNow(),notified:(0,i.O7)("notified").default(!1).notNull(),hasPostedAssistance:(0,i.O7)("has_posted_assistance").default(!1).notNull()},e=>({pk:(0,o.CK)({columns:[e.caseNumber,e.threadTs]}),resolvedIdx:(0,l.Kz)("idx_resolved").on(e.isResolved,e.notified),caseNumberIdx:(0,l.Kz)("idx_case_number").on(e.caseNumber),lastUpdatedIdx:(0,l.Kz)("idx_last_updated").on(e.lastUpdated)})),f=(0,n.af)("case_messages",{id:(0,u.eP)("id").primaryKey(),caseNumber:(0,r.fL)("case_number").notNull(),threadTs:(0,r.fL)("thread_ts").notNull(),userId:(0,r.fL)("user_id").notNull(),messageText:(0,r.fL)("message_text").notNull(),messageTimestamp:(0,r.fL)("message_timestamp").notNull(),createdAt:(0,a.AB)("created_at").notNull().defaultNow()},e=>({caseThreadIdx:(0,l.Kz)("idx_case_thread").on(e.caseNumber,e.threadTs),timestampIdx:(0,l.Kz)("idx_timestamp").on(e.messageTimestamp)})),y=(0,n.af)("kb_generation_states",{caseNumber:(0,r.fL)("case_number").notNull(),threadTs:(0,r.fL)("thread_ts").notNull(),channelId:(0,r.fL)("channel_id").notNull(),state:(0,r.fL)("state").notNull(),attemptCount:(0,d._L)("attempt_count").notNull().default(0),userResponses:(0,c.JB)("user_responses").$type().default([]).notNull(),assessmentScore:(0,d._L)("assessment_score"),missingInfo:(0,c.JB)("missing_info").$type().default([]).notNull(),startedAt:(0,a.AB)("started_at").notNull().defaultNow(),lastUpdated:(0,a.AB)("last_updated").notNull().defaultNow()},e=>({pk:(0,o.CK)({columns:[e.caseNumber,e.threadTs]}),stateIdx:(0,l.Kz)("idx_state").on(e.state),lastUpdatedStateIdx:(0,l.Kz)("idx_last_updated_state").on(e.lastUpdated)})),x=(0,n.af)("business_contexts",{id:(0,u.eP)("id").primaryKey(),entityName:(0,r.fL)("entity_name").notNull().unique(),entityType:(0,r.fL)("entity_type").notNull(),industry:(0,r.fL)("industry"),description:(0,r.fL)("description"),aliases:(0,c.JB)("aliases").$type().default([]).notNull(),relatedEntities:(0,c.JB)("related_entities").$type().default([]).notNull(),technologyPortfolio:(0,r.fL)("technology_portfolio"),serviceDetails:(0,r.fL)("service_details"),keyContacts:(0,c.JB)("key_contacts").$type().default([]).notNull(),slackChannels:(0,c.JB)("slack_channels").$type().default([]).notNull(),cmdbIdentifiers:(0,c.JB)("cmdb_identifiers").$type().default([]).notNull(),contextStewards:(0,c.JB)("context_stewards").$type().default([]).notNull(),isActive:(0,i.O7)("is_active").default(!0).notNull(),createdAt:(0,a.AB)("created_at").notNull().defaultNow(),updatedAt:(0,a.AB)("updated_at").notNull().defaultNow()},e=>({entityNameIdx:(0,l.Kz)("idx_entity_name").on(e.entityName),entityTypeIdx:(0,l.Kz)("idx_entity_type").on(e.entityType),isActiveIdx:(0,l.Kz)("idx_is_active").on(e.isActive)}))}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[356,922,176],()=>s(4988));module.exports=n})();